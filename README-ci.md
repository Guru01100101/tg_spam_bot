# CI/CD для Telegram бота з фільтрацією спаму

Цей документ описує налаштовану систему CI/CD для автоматичного тестування, збірки та майбутнього розгортання Telegram бота.

## Опис CI/CD процесу

### Безперервна Інтеграція (CI)

CI налаштовано за допомогою GitHub Actions і складається з наступних етапів:

1. **Тестування**:
   - Запуск автоматичних тестів для перевірки функціональності бота
   - Особливий фокус на тестуванні механізму нормалізації повідомлень

2. **Статичний аналіз коду**:
   - Перевірка стилю коду за допомогою Flake8
   - Перевірка типізації за допомогою MyPy

3. **Збірка Docker-образу**:
   - Створення оптимізованого Docker-образу
   - Збереження образу як артефакту для подальшого використання

### Як запустити CI локально

Для запуску тестів локально:

```bash
uv pip install pytest flake8 mypy
pytest tests/ -v
flake8 .
mypy --no-check-untyped-defs --ignore-missing-imports core/ models/ utils/ main.py
```

### Безперервна доставка (CD)

Налаштовано автоматичну публікацію Docker-образів у DockerHub:

1. **Гілка `dev`** — публікується з тегом `latest`
2. **Гілка `main`** — публікується з тегами:
   - `stable` — фіксований тег для стабільної версії
   - `v*.*.*` — версійний тег на основі версії з `pyproject.toml`

#### Налаштування публікації у DockerHub

Для роботи автоматичної публікації необхідно додати секрети в налаштуваннях GitHub репозиторію:

1. Перейдіть в **Settings** → **Secrets and variables** → **Actions**
2. Додайте два секрети:
   - `DOCKERHUB_USERNAME`: Ваш логін у DockerHub
   - `DOCKERHUB_TOKEN`: Токен доступу (створіть в налаштуваннях DockerHub)

#### Використання опублікованих образів

```bash
# Стабільна версія
docker run -d --env-file .env --name tg_spam_bot guru01100101/tg_spam_bot:stable

# Остання development версія
docker run -d --env-file .env --name tg_spam_bot guru01100101/tg_spam_bot:latest

# Конкретна версія
docker run -d --env-file .env --name tg_spam_bot guru01100101/tg_spam_bot:v1.0.0
```

Або за допомогою Docker Compose:

```bash
# Створіть файл .env з необхідними змінними оточення
docker-compose up -d
```

## Плани з розвитку CI/CD

В майбутньому планується розширити систему CI/CD:

1. **Автоматичне розгортання на сервері**:
   - Автоматичне оновлення бота на production сервері після успішної збірки
   - Резервне копіювання даних перед оновленням

2. **Автоматичне створення нових ботів**:
   - Інтеграція з Telegram Bot API для створення нових ботів
   - Автоматичне розгортання ботів для нових клієнтів

3. **Покращення тестування**:
   - Розширення тестів для покриття більшої частини функціональності
   - Додавання інтеграційних тестів

## Структура CI/CD файлів

- `.github/workflows/ci.yml` - основний конфігураційний файл для GitHub Actions
- `Dockerfile` - файл для збірки Docker-образу
- `docker-compose.yml` - конфігурація для розгортання з Docker Compose
- `tests/` - директорія з автоматичними тестами
  - `test_normalize.py` - тести для функціональності нормалізації повідомлень
  - `test_spam_filter.py` - тести для функціональності фільтрації спаму

## Схема CI/CD процесу

```ascii
┌────────────┐       ┌─────────────┐      ┌────────────┐
│ Код у git  │───────► CI тести    │──────► Збірка     │
└────────────┘       └─────────────┘      └─────┬──────┘
                                               │
                                               ▼
┌────────────┐       ┌─────────────┐      ┌────────────┐
│ Запуск     │◄──────┤ Розгортання │◄─────┤ DockerHub  │
│ бота       │       │ на сервері  │      │ публікація │
└────────────┘       └─────────────┘      └────────────┘
```
